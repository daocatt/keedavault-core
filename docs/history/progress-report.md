# KeedaVault Core - å®æ–½è¿›åº¦æŠ¥å‘Š

**æ—¥æœŸ**: 2025-12-14  
**é˜¶æ®µ**: Phase 1 - Core åº“åŸºç¡€

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. TOTP åŠŸèƒ½å®ç° âœ…
- âœ… å®ç°äº†å®Œæ•´çš„ TOTP ç”ŸæˆåŠŸèƒ½ (`generate_totp`)
- âœ… å®ç°äº† TOTP éªŒè¯åŠŸèƒ½ (`validate_totp`)
- âœ… å®ç°äº† Base32 ç¼–ç /è§£ç 
- âœ… æ·»åŠ äº†è¾…åŠ©å‡½æ•° `get_remaining_seconds()`
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–

**æŠ€æœ¯ç»†èŠ‚**:
- ä½¿ç”¨ `totp-lite` crate
- æ”¯æŒæ ‡å‡† 6 ä½æ•°å­—ä»£ç 
- 30 ç§’æ—¶é—´çª—å£
- Â±1 æ—¶é—´çª—å£å®¹é”™ï¼ˆå¤„ç†æ—¶é’Ÿæ¼‚ç§»ï¼‰
- ç¬¦åˆ RFC 4648 (Base32) å’Œ RFC 6238 (TOTP)

### 2. Entry/Group CRUD æ¶æ„è®¾è®¡ ğŸ”„
- âœ… è®¾è®¡äº†å®Œæ•´çš„ CRUD æ¥å£
- âœ… å®ç°äº†æ•°æ®ç»“æ„è½¬æ¢é€»è¾‘
- âš ï¸ é‡åˆ° keepass 0.8 API å…¼å®¹æ€§é—®é¢˜

## âš ï¸ å½“å‰é—®é¢˜

### keepass 0.8 API å·®å¼‚

å‘ç° `keepass` crate 0.8 ç‰ˆæœ¬çš„ API ä¸é¢„æœŸä¸åŒï¼š

1. **æ²¡æœ‰ `set_*` æ–¹æ³•**: 
   - ä¸å­˜åœ¨ `set_title()`, `set_username()`, `set_password()` ç­‰æ–¹æ³•
   - éœ€è¦ç›´æ¥æ“ä½œ `fields` HashMap

2. **ç±»å‹ç³»ç»Ÿå·®å¼‚**:
   - `keepass::db::Value::Protected` ä½¿ç”¨ `secstr::SecVec<u8>` è€Œä¸æ˜¯ `Vec<u8>`
   - éœ€è¦é¢å¤–çš„ç±»å‹è½¬æ¢

3. **æ•°æ®ç»“æ„è®¿é—®**:
   - `Group.children` æ˜¯ `Vec<Node>` è€Œä¸æ˜¯ `Vec<Group>`
   - `entries` æ˜¯æ–¹æ³•è€Œä¸æ˜¯å­—æ®µ
   - æ—¶é—´æˆ³ç±»å‹ä¸º `NaiveDateTime` è€Œä¸æ˜¯ `DateTime<Utc>`

## ğŸ¯ å»ºè®®çš„è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ A: ç®€åŒ–å®ç°ï¼ˆæ¨èï¼‰

æš‚æ—¶ä½¿ç”¨æ›´ç®€å•çš„ CRUD å®ç°ï¼Œä¸“æ³¨äºæ ¸å¿ƒåŠŸèƒ½ï¼š

1. **åªè¯»åŠŸèƒ½ä¼˜å…ˆ**:
   - `get_entries()` - è¯»å–ç°æœ‰æ¡ç›®
   - `get_groups()` - è¯»å–ç°æœ‰åˆ†ç»„
   - `get_entry(id)` - è·å–å•ä¸ªæ¡ç›®

2. **å†™å…¥åŠŸèƒ½å»¶å**:
   - å°† `add_entry`, `update_entry`, `delete_entry` æ ‡è®°ä¸º "TODO"
   - åœ¨ Phase 2 (Desktop é›†æˆ) æ—¶ï¼Œæ ¹æ®å®é™…éœ€æ±‚å†å®Œå–„

3. **ä¼˜å…ˆçº§è°ƒæ•´**:
   - âœ… TOTP åŠŸèƒ½ï¼ˆå·²å®Œæˆï¼‰
   - ğŸ”„ UniFFI iOS ç»‘å®šï¼ˆä¸‹ä¸€æ­¥ï¼‰
   - â³ CRUD å®Œæ•´å®ç°ï¼ˆPhase 2ï¼‰

### æ–¹æ¡ˆ B: æ·±å…¥ç ”ç©¶ keepass API

èŠ±æ›´å¤šæ—¶é—´ç ”ç©¶ `keepass` crate çš„æ–‡æ¡£å’Œæºç ï¼Œå®Œå…¨é€‚é…å…¶ APIã€‚

**ä¼˜ç‚¹**: åŠŸèƒ½å®Œæ•´  
**ç¼ºç‚¹**: è€—æ—¶è¾ƒé•¿ï¼Œå¯èƒ½å»¶è¯¯æ•´ä½“è¿›åº¦

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®

### ç«‹å³æ‰§è¡Œï¼ˆæ¨èï¼‰:

1. **å®Œæˆ UniFFI ç»‘å®š** (1-2å°æ—¶)
   - åˆ›å»º `uniffi/vault.udl` æ–‡ä»¶
   - å®šä¹‰ iOS æ¥å£
   - é…ç½®æ„å»ºè„šæœ¬
   - æµ‹è¯• Swift ç»‘å®šç”Ÿæˆ

2. **ç®€åŒ– CRUD å®ç°** (30åˆ†é’Ÿ)
   - ä¿ç•™åªè¯»åŠŸèƒ½
   - å°†å†™å…¥åŠŸèƒ½æ ‡è®°ä¸º Phase 2
   - ç¡®ä¿ç¼–è¯‘é€šè¿‡
   - æ›´æ–°æµ‹è¯•

3. **æ–‡æ¡£æ›´æ–°** (15åˆ†é’Ÿ)
   - æ›´æ–° README.md
   - åˆ›å»º API æ–‡æ¡£
   - è®°å½•å·²çŸ¥é™åˆ¶

4. **æäº¤ Phase 1 æˆæœ**
   - Git commit
   - åˆ›å»º v0.2.0 tag
   - å‡†å¤‡è¿›å…¥ Phase 2

### å»¶åæ‰§è¡Œ:

- **å®Œæ•´ CRUD å®ç°**: åœ¨ Desktop é›†æˆæ—¶æ ¹æ®å®é™…éœ€æ±‚å®Œå–„
- **æ€§èƒ½ä¼˜åŒ–**: åœ¨æœ‰å®é™…æ€§èƒ½æ•°æ®åè¿›è¡Œ

## ğŸ“Š å½“å‰ä»£ç ç»Ÿè®¡

- **æ€»ä»£ç è¡Œæ•°**: ~1200 è¡Œ
- **æµ‹è¯•æ•°é‡**: 15+ ä¸ª
- **æ¨¡å—æ•°é‡**: 8 ä¸ª
- **ç¼–è¯‘çŠ¶æ€**: âš ï¸ æœ‰é”™è¯¯ï¼ˆCRUD éƒ¨åˆ†ï¼‰
- **TOTP æ¨¡å—**: âœ… å®Œå…¨æ­£å¸¸

## ğŸ¯ Phase 1 ç›®æ ‡è°ƒæ•´

### åŸè®¡åˆ’:
- âœ… åŸºç¡€æ•°æ®ç»“æ„
- âœ… TOTP åŠŸèƒ½
- â³ å®Œæ•´ CRUD
- â³ UniFFI ç»‘å®š

### è°ƒæ•´å:
- âœ… åŸºç¡€æ•°æ®ç»“æ„
- âœ… TOTP åŠŸèƒ½
- ğŸ”„ åŸºç¡€ CRUDï¼ˆåªè¯»ï¼‰
- ğŸ¯ UniFFI ç»‘å®šï¼ˆä¸‹ä¸€æ­¥ï¼‰

## ğŸ’¡ æŠ€æœ¯æ´å¯Ÿ

### keepass Crate ä½¿ç”¨å»ºè®®

```rust
// âœ… æ­£ç¡®çš„æ–¹å¼
let mut entry = keepass::db::Entry::default();
entry.fields.insert("Title".to_string(), 
    keepass::db::Value::Unprotected(title));
entry.fields.insert("Password".to_string(), 
    keepass::db::Value::Protected(password.as_bytes().to_vec().into()));

// âŒ ä¸å­˜åœ¨çš„æ–¹å¼
entry.set_title(&title);  // è¿™ä¸ªæ–¹æ³•ä¸å­˜åœ¨
```

### SecVec ç±»å‹è½¬æ¢

```rust
use secstr::SecVec;

// Vec<u8> -> SecVec<u8>
let sec_vec: SecVec<u8> = password.as_bytes().to_vec().into();

// SecVec<u8> -> Vec<u8>
let vec: Vec<u8> = sec_vec.unsecure().to_vec();
```

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [keepass crate æ–‡æ¡£](https://docs.rs/keepass/0.8/)
- [UniFFI æŒ‡å—](https://mozilla.github.io/uniffi-rs/)
- [å®æ–½è®¡åˆ’](./implementation-plan.md)
- [é¡¹ç›®ç»“æ„](./project-structure.md)

---

**å»ºè®®**: é‡‡ç”¨æ–¹æ¡ˆ Aï¼Œå…ˆå®Œæˆ UniFFI ç»‘å®šï¼Œç¡®ä¿ Phase 1 çš„æ ¸å¿ƒç›®æ ‡è¾¾æˆï¼ŒCRUD çš„å®Œæ•´å®ç°å¯ä»¥åœ¨ Phase 2 æ ¹æ®å®é™…éœ€æ±‚è¿­ä»£å®Œå–„ã€‚
